# 宝塔进程守护管理器部署程序

### 为什么要使用进程守护管理器(Supervisor)部署程序？
``` 
如果通过ssh命令行部署，关闭ssh对话框后，进程就会被杀掉，为了能让程序常驻运行，所以要使用一款守护工具来启动，这里使用宝塔的进程守护管理器（Supervisor)。当然你也可以使用其他的可以守护进程的工具来启动程序。
```

## 1.下载程序
    可以在这里下载最新的程序 https://github.com/deep-project/moss/releases
    然后放到服务器上
    我们这里放到 /www/wwwroot/ 目录（其他目录亦可）
    所以程序的完整地址就是 /www/wwwroot/moss (自己把下载的程序重命名下，或者用原名也可以)

## 2.创建网站目录
    在 /www/wwwroot/ 创建我们的网站目录
    比如创建这样的目录 /www/wwwroot/www.foo.com/
    这里也可以在任何目录创建，之所以在这里创建，是为了符合宝塔的目录习惯

## 3.安装进程守护管理器

    点击软件商店，搜索“进程守护管理器”，点击安装


## 4.配置进程管理器
    点击添加守护进程
    名称：填写随意英文
    运行目录：/www/wwwroot/www.foo.com/
    启动命令：/www/wwwroot/moss
    点击确定
    这时候不出意外程序就启动了，可以在进程管理器的日志里查看启动日志，如果出现意外请联系我，告诉日志提示什么，我帮你分析一下。
    程序默认启动后会随机一个端口，建议到 /www/wwwroot/www.foo.com/目录下的配置文件中定义死一个端口，方便后续使用nginx转发

## 5.自定义端口
    打开/www/wwwroot/www.foo.com/目录下 conf.toml文件
    配置 addr 为 ":9008" (这里端口自己随意定义，别冲突就行)
    然后到进程守护管理器中重启一下守护的进程，这时候程序就运行在9008端口了。

## 6.添加nginx转发
    如果你只用一个站，可以不使用宝塔的网站管理，在上面直接监听80端口，就没必要转发了。
    但大部分人都是一个服务器多个站，这样就要通过端口转发。
    1.在网站管理中添加站点
    2.填写域名和根目录，（注意！这里的根目录千万不要填写/www/wwwroot/www.foo.com/ 因为这里添加的是反代站点，不是真实的站点）
    建议根目录填写：/www/wwwroot/default/
    3.其他都选择不创建，php版本选择纯静态，点击提交
    4.设置刚添加的站点，点击反向代理，点击添加反向代理
    5.填写代理名称（随意）
      目标URL：http://127.0.0.1:9008
      点击提交
    
## 大功告成，这时候访问你的域名，就可以看到效果了。

    其实通过网站管理中的GO项目也是可以部署的，喜欢研究的可以研究研究。
