import{j as c,k as s,l as r,m as e,v as i,$ as d,y as n,z as l,p as x,F as L,Q as G,s as I,n as y,r as C,c as D,Y as X,V as Z}from"./@vue.0987707a.js";import{a as ee}from"./vue-router.0ed66d6f.js";import{e as V,u as te,v as ae,f as le}from"./index.8b92274b.js";import{a as ie}from"./@vueuse.d5398ce4.js";import{a as oe}from"./vue-request.6886b8d7.js";import{f as z}from"./naive-ui.506a45a0.js";import"./vue-i18n.e3137642.js";import"./@intlify.bed9fa1a.js";import"./source-map.205bdfab.js";import"./vue.5c5bb0aa.js";import"./@arco-design.55369db5.js";import"./resize-observer-polyfill.8deb1e21.js";import"./compute-scroll-into-view.17358474.js";import"./b-tween.87ffe365.js";import"./dayjs.396bdce9.js";import"./b-validate.ee581f7d.js";import"./number-precision.6dad9ff9.js";import"./scroll-into-view-if-needed.61c672a4.js";import"./pinia.2e07300c.js";import"./vue-demi.b3a9cad9.js";import"./axios.b9f958b0.js";/* empty css                    */import"./date-fns.a06005bd.js";import"./seemly.d0f7d7a4.js";import"./evtd.9eee5233.js";import"./@css-render.6ced7bf3.js";import"./css-render.20ab466e.js";import"./@emotion.6322e2ae.js";import"./vooks.3f61458b.js";import"./vueuc.5f5811a3.js";import"./vdirs.ab69c576.js";import"./@juggle.32c34d6c.js";import"./lodash-es.33d1f95f.js";import"./date-fns-tz.c3c7eb03.js";const ne=[{width:30,slotName:"detail"},{title:"time",dataIndex:"time",slotName:"time",width:120},{title:"level",dataIndex:"level",slotName:"level",width:100},{title:"file",dataIndex:"file",ellipsis:!0,width:200},{title:"message",dataIndex:"msg",ellipsis:!0,width:200},{title:"more",dataIndex:"more",slotName:"more",ellipsis:!0,width:300}],O=[{width:30,slotName:"detail"},{title:"time",dataIndex:"time",slotName:"time",width:120},{title:"take",dataIndex:"take",slotName:"take",width:100},{title:"file",dataIndex:"file",ellipsis:!0,width:170},{title:"rows",dataIndex:"rows",slotName:"rows",width:80},{title:"sql",dataIndex:"sql",ellipsis:!0,width:400}],R=[{width:30,slotName:"detail"},{title:"time",dataIndex:"time",slotName:"time",width:120},{title:"take",dataIndex:"take",slotName:"take",width:100},{title:"status",dataIndex:"status",slotName:"status",width:80},{title:"depth",dataIndex:"depth",width:70},{title:"ip",dataIndex:"ip",width:140,ellipsis:!0},{title:"method",dataIndex:"method",width:80},{title:"url",dataIndex:"url",width:400,ellipsis:!0,slotName:"url"},{title:"referer",dataIndex:"referer",width:300,ellipsis:!0,slotName:"url"},{title:"userAgent",dataIndex:"userAgent",width:600,ellipsis:!0}],se={class:"font-mono text-gray-500 whitespace-pre"},de={__name:"app",props:{data:Object},setup(o){return(w,v)=>{const a=c("a-descriptions-item"),f=c("a-descriptions");return s(),r(f,{column:1,bordered:""},{default:e(()=>[i(a,{label:"time"},{default:e(()=>[i(d(z),{time:o.data.time},null,8,["time"])]),_:1}),i(a,{label:"level"},{default:e(()=>[n(l(o.data.level),1)]),_:1}),i(a,{label:"file"},{default:e(()=>[n(l(o.data.file),1)]),_:1}),i(a,{label:"msg"},{default:e(()=>[n(l(o.data.msg),1)]),_:1}),(s(!0),x(L,null,G(o.data.more,(u,p)=>(s(),x(L,null,[p!=="buf"?(s(),r(a,{key:0,label:p},{default:e(()=>[n(l(u),1)]),_:2},1032,["label"])):I("",!0)],64))),256)),o.data.buf?(s(),r(a,{key:0,label:"buf"},{default:e(()=>[y("code",se,l(o.data.buf),1)]),_:1})):I("",!0)]),_:1})}}},re={class:"font-mono text-gray-500 whitespace-pre"},ue={__name:"http",props:{data:Object},setup(o){return(w,v)=>{const a=c("a-descriptions-item"),f=c("a-descriptions");return s(),r(f,{column:1,bordered:""},{default:e(()=>[i(a,{label:"time"},{default:e(()=>[i(d(z),{time:o.data.time},null,8,["time"])]),_:1}),i(a,{label:"take"},{default:e(()=>[n(l(o.data.take)+" ms",1)]),_:1}),i(a,{label:"status"},{default:e(()=>[n(l(o.data.status),1)]),_:1}),i(a,{label:"depth"},{default:e(()=>[n(l(o.data.depth),1)]),_:1}),i(a,{label:"method"},{default:e(()=>[n(l(o.data.method),1)]),_:1}),i(a,{label:"ip"},{default:e(()=>[n(l(o.data.ip),1)]),_:1}),i(a,{label:"region"},{default:e(()=>[n(l(o.data.region),1)]),_:1}),i(a,{label:"url"},{default:e(()=>[y("a",{class:"hover:underline cursor-pointer hover:text-blue-400",onClick:v[0]||(v[0]=u=>d(V)(o.data.url))},l(o.data.url),1)]),_:1}),i(a,{label:"referer"},{default:e(()=>[y("a",{class:"hover:underline cursor-pointer hover:text-blue-400",onClick:v[1]||(v[1]=u=>d(V)(o.data.referer))},l(o.data.referer),1)]),_:1}),i(a,{label:"user-agent"},{default:e(()=>[n(l(o.data.userAgent),1)]),_:1}),i(a,{label:"headers"},{default:e(()=>[y("code",re,l(o.data.headers),1)]),_:1})]),_:1})}}};const me={class:"py-2 my-2"},ce=["innerHTML"],fe={__name:"sql",props:{data:Object},setup(o){let w=["select ","from ","distinct"," where "," order by "," group by "," insert into"," inner join"," left join"," and ","having","values","on conflict","do update set"," create table"," limit "," as "," update "," offset "," set ","do nothing","alter table ","alter column ","type ","default ","in "];function v(a){if(!a)return a;for(let f=0;f<w.length;f++){let u=w[f],p=u.toUpperCase();a=a.replaceAll(u,p),a=a.replaceAll(p,"<b>"+p+"</b>")}return a.replace(/"([^"]*)"/g,'"<i>$1</i>"').replace(/'([^']*)'/g,"'<i>$1</i>'")}return(a,f)=>{const u=c("a-descriptions-item"),p=c("a-descriptions");return s(),r(p,{column:1,bordered:""},{default:e(()=>[i(u,{label:"time"},{default:e(()=>[i(d(z),{time:o.data.time},null,8,["time"])]),_:1}),i(u,{label:"level"},{default:e(()=>[n(l(o.data.level),1)]),_:1}),i(u,{label:"take"},{default:e(()=>[n(l(o.data.take)+" ms",1)]),_:1}),i(u,{label:"file"},{default:e(()=>[n(l(o.data.file),1)]),_:1}),i(u,{label:"rows"},{default:e(()=>[n(l(o.data.rows),1)]),_:1}),i(u,{label:"msg"},{default:e(()=>[n(l(o.data.msg),1)]),_:1}),i(u,{label:"sql"},{default:e(()=>[y("div",me,[y("code",{class:"sql font-mono",innerHTML:v(o.data.sql)},null,8,ce)])]),_:1})]),_:1})}}},pe=y("th",{style:{color:"var(--color-text-1)","background-color":"var(--color-fill-2)"}},null,-1),_e=y("td",{style:{color:"var(--color-text-1)"}},null,-1),he={class:"flex items-center"},be=["onClick"],ye={key:0},ge={key:1},ve={key:0},tt={__name:"index",setup(o){const w=te(),a=ee().params.id.toString(),f=ie("log_limit",100),u=C(),p=D(()=>w.mainHeight-66),$=C(!1),N=C({}),S=D(()=>{switch(a){case"app":return ne;case"sql":return O;case"slow_sql":return O;case"visitor":return R;case"spider":return R}});async function T(m){const b=m!=null&&m.page?m.page+1:1,g=await ae(a,{page:b,limit:f.value});return{list:K(g),page:b}}const{loading:H,loadingMore:M,dataList:j,loadMore:B,refresh:F}=oe(T,{});function q(){F()}function K(m){if(m=m.reverse(),a!=="app")return m;for(let b in m){let g=le(m[b]);delete g.level,delete g.time,delete g.file,delete g.msg,m[b].more=g}return m}return(m,b)=>{const g=c("a-input-number"),A=c("a-button"),P=c("a-space"),U=c("icon-eye"),Q=c("a-link"),_=c("a-tag"),W=c("a-table"),E=c("a-card"),J=c("a-modal");return s(),x(L,null,[i(E,{class:"w-full",size:"small",title:m.$t(d(a)),bordered:!1,"body-style":{padding:"0"},"header-style":{border:"none",padding:"8px 0"}},{extra:e(()=>[i(P,null,{default:e(()=>[i(g,{size:"small",modelValue:d(f),"onUpdate:modelValue":b[0]||(b[0]=t=>X(f)?f.value=t:null),style:{width:"80px"},min:1,onKeyup:Z(q,["enter"])},null,8,["modelValue","onKeyup"]),i(A,{size:"small",onClick:q,type:"outline"},{default:e(()=>[n(l(m.$t("refresh")),1)]),_:1}),i(A,{size:"small",onClick:d(B),type:"outline"},{default:e(()=>[n(l(m.$t("more")),1)]),_:1},8,["onClick"])]),_:1})]),default:e(()=>[i(W,{size:"mini",ref_key:"tableRef",ref:u,columns:d(S),data:d(j),pagination:!1,scroll:{y:d(p)},"virtual-list-props":d(j).length>1?{height:d(p),buffer:30}:void 0,loading:d(H)||d(M),style:{"--border-radius-medium":"0"}},{th:e(()=>[pe]),td:e(()=>[_e]),detail:e(({record:t,rowIndex:k,column:h})=>[y("div",he,[i(Q,{onClick:Y=>{$.value=!0,N.value=t}},{default:e(()=>[i(U,{style:{color:"#6b7f94"}})]),_:2},1032,["onClick"])])]),time:e(({record:t,rowIndex:k,column:h})=>[i(d(z),{time:t.time,to:Date.now(),type:"relative"},null,8,["time","to"])]),take:e(({record:t,rowIndex:k,column:h})=>[t.take<100?(s(),r(_,{key:0,size:"mini",color:"blue"},{default:e(()=>[n(l(t.take.toFixed(2))+" ms",1)]),_:2},1024)):t.take<200?(s(),r(_,{key:1,size:"mini",color:"orange"},{default:e(()=>[n(l(parseInt(t.take))+" ms",1)]),_:2},1024)):t.take<500?(s(),r(_,{key:2,size:"mini",color:"purple"},{default:e(()=>[n(l(parseInt(t.take))+" ms",1)]),_:2},1024)):(s(),r(_,{key:3,size:"mini",color:"red"},{default:e(()=>[n(l(parseInt(t.take))+" ms",1)]),_:2},1024))]),status:e(({record:t,rowIndex:k,column:h})=>[t.status>=500?(s(),r(_,{key:0,size:"mini",color:"red"},{default:e(()=>[n(l(t.status),1)]),_:2},1024)):t.status>=400?(s(),r(_,{key:1,size:"mini",color:"orange"},{default:e(()=>[n(l(t.status),1)]),_:2},1024)):t.status>=300?(s(),r(_,{key:2,size:"mini",color:"blue"},{default:e(()=>[n(l(t.status),1)]),_:2},1024)):(s(),r(_,{key:3,size:"mini",color:"green"},{default:e(()=>[n(l(t.status),1)]),_:2},1024))]),url:e(({record:t,rowIndex:k,column:h})=>[y("a",{class:"hover:underline cursor-pointer hover:text-blue-400",onClick:Y=>d(V)(t[h.dataIndex])},l(t[h.dataIndex]),9,be)]),level:e(({record:t,rowIndex:k,column:h})=>[t.level==="info"?(s(),r(_,{key:0,size:"mini",color:"blue"},{default:e(()=>[n(l(t.level),1)]),_:2},1024)):t.level==="debug"?(s(),r(_,{key:1,size:"mini",color:"cyan"},{default:e(()=>[n(l(t.level),1)]),_:2},1024)):(s(),r(_,{key:2,size:"mini",color:"red"},{default:e(()=>[n(l(t.level),1)]),_:2},1024))]),rows:e(({record:t,rowIndex:k,column:h})=>[t.rows>-1?(s(),x("span",ye,l(t.rows),1)):(s(),x("span",ge," - "))]),more:e(({record:t,rowIndex:k,column:h})=>[Object.keys(t[h.dataIndex]).length>0?(s(),x("div",ve,l(JSON.stringify(t[h.dataIndex]).substring(0,130)),1)):I("",!0)]),_:1},8,["columns","data","scroll","virtual-list-props","loading"])]),_:1},8,["title"]),i(J,{visible:$.value,"onUpdate:visible":b[1]||(b[1]=t=>$.value=t),title:"Log detail","title-align":"start","modal-style":{width:"auto",height:"92%",minWidth:"600px",maxWidth:"80%"},"body-style":{height:"calc(100% - 52px)"},footer:!1},{default:e(()=>[d(a)==="app"?(s(),r(de,{key:0,data:N.value},null,8,["data"])):I("",!0),d(a)==="sql"||d(a)==="slow_sql"?(s(),r(fe,{key:1,data:N.value},null,8,["data"])):I("",!0),d(a)==="visitor"||d(a)==="spider"?(s(),r(ue,{key:2,data:N.value},null,8,["data"])):I("",!0)]),_:1},8,["visible","body-style"])],64)}}};export{tt as default};
