import{i as K,j as r,$ as i,k as g,p as $,v as n,m as t,y as h,z as f,F as B,s as ie,n as V,u as se,l as N,X as He,r as x,c as oe,a as le,B as z,q,H as Ke,Q as qe,Y as Ee,O as Ge}from"./@vue.0987707a.js";import{u as S}from"./vue-request.6886b8d7.js";import{u as re,k as P,e as E,i as Te,m as Ae,n as We,o as Je,p as Qe,q as Xe,r as Ye,s as Ze,j as et,v as tt}from"./index.9ecc5556.js";import{a as nt}from"./@vueuse.d5398ce4.js";import{k as ot,M as ue}from"./@arco-design.370b0a2d.js";import{f as ae}from"./naive-ui.506a45a0.js";const lt={__name:"Checkbox",setup(e){const a=K("selectedKeys"),s=K("batchDelete"),l=K("modelName");return(b,v)=>{const y=r("icon-down"),p=r("a-button"),w=r("icon-delete"),F=r("a-doption"),R=r("a-dropdown"),j=r("a-tag");return i(a).length>0?(g(),$(B,{key:0},[n(R,{"popup-max-height":!1,trigger:"hover"},{content:t(()=>[n(F,{onClick:v[0]||(v[0]=L=>i(s)(i(l),i(a))),style:{color:"rgb(var(--red-6))"}},{icon:t(()=>[n(w)]),default:t(()=>[h(" "+f(b.$t("delete")),1)]),_:1})]),default:t(()=>[n(p,{size:"small"},{icon:t(()=>[n(y)]),default:t(()=>[h(" "+f(b.$t("action")),1)]),_:1})]),_:1}),n(j,{class:"ml-4 overflow-hidden",style:{"border-radius":"18px","background-color":"var(--color-fill-2)"},onClose:v[1]||(v[1]=L=>a.value=[]),closable:""},{default:t(()=>[h(f(b.$t("checked"))+" "+f(i(a).length),1)]),_:1})],64)):ie("",!0)}}},at={class:"flex justify-between select-none"},it={__name:"ColumnSearch",props:{filterValue:Object,setFilterValue:Function,handleFilterReset:Function,handleFilterConfirm:Function},setup(e){const a=re();return(s,l)=>{const b=r("a-input"),v=r("a-checkbox"),y=r("a-button"),p=r("a-space");return g(),$("div",{class:se(["p-3 shadow-md",{border:!i(a).dark}]),style:{"background-color":"var(--color-bg-1)"}},[n(p,{direction:"vertical"},{default:t(()=>[n(b,{"model-value":e.filterValue[0],placeholder:s.$t("search"),onInput:l[0]||(l[0]=w=>e.setFilterValue([w,e.filterValue[1]]))},null,8,["model-value","placeholder"]),V("div",at,[n(v,{modelValue:e.filterValue[1],"onUpdate:modelValue":l[1]||(l[1]=w=>e.filterValue[1]=w)},{default:t(()=>[h("Like")]),_:1},8,["modelValue"]),n(p,{class:"pl-5"},{default:t(()=>[n(y,{size:"mini",onClick:e.handleFilterReset},{default:t(()=>[h(f(s.$t("reset")),1)]),_:1},8,["onClick"]),n(y,{type:"primary",size:"mini",onClick:e.handleFilterConfirm},{default:t(()=>[h(f(s.$t("confirm")),1)]),_:1},8,["onClick"])]),_:1})])]),_:1})],2)}}},st={__name:"Action",props:{record:Object,modelName:String,rowIndex:Number,runDelete:Function,onEdit:Function},setup(e){return(a,s)=>{const l=r("a-button"),b=r("icon-down"),v=r("icon-delete"),y=r("a-doption"),p=r("a-dropdown"),w=r("a-button-group");return g(),N(w,{size:"mini"},{default:t(()=>[n(l,{onClick:s[0]||(s[0]=F=>e.onEdit(e.record,e.rowIndex))},{default:t(()=>[h(f(a.$t("edit")),1)]),_:1}),n(p,{position:"br",size:"small"},{content:t(()=>[n(y,{onClick:s[1]||(s[1]=F=>e.runDelete(e.modelName,e.record.id)),style:{color:"rgb(var(--red-6))"}},{icon:t(()=>[n(v)]),default:t(()=>[h(" "+f(a.$t("delete")),1)]),_:1})]),default:t(()=>[n(l,null,{icon:t(()=>[n(b)]),_:1})]),_:1})]),_:1})}}},It={slotName:"column-search",icon:()=>He(ot)};function rt(e,a,s,l){return{total:e.value?9999:a.value,defaultPageSize:s.limit,showTotal:!e.value,showJumper:!l.isMobile&&!e.value,showPageSize:!l.isMobile&&!e.value,simple:l.isMobile||e.value,pageSizeOptions:[10,20,30,40,50,100,500,1e3,2e3,5e3]}}function ut(e,a){return{defaultParams:[e,a]}}function ct(e){return{manual:!0,onSuccess:a=>{a.success&&e()}}}function dt(e,a){return{manual:!0,onSuccess:s=>{!s.success||(e.value=[],a())}}}function mt(e,a){return{manual:!0,onSuccess:s=>{e.value=s,a.value&&a.value(s)}}}function ft(e,a,s){return{manual:!0,onBefore:()=>{s.value&&s.value()},onSuccess:l=>{if(!l.success)return ce(l);e.value=!1,a()}}}function pt(e,a,s,l,b){return{manual:!0,onSuccess:v=>{if(!v.success)return ce(v);e.value=!1;for(let y in a.value[s.value])a.value[s.value][y]=l.value[y];b.value&&b.value()}}}function gt(e){return{manual:!0,onSuccess:a=>{a.success&&(ue.success(P("message.success",[P("publish")])),e())}}}function ce(e){e.message.toLowerCase().indexOf("unique")>-1&&e.message.toLowerCase().indexOf("slug")>-1&&ue.error(P("message.exists",[P("slug")]))}const ht=V("th",{style:{color:"var(--color-text-3)"}},null,-1),_t=["onDblclick"],vt={key:1},bt={key:1},yt=["onClick"],kt={key:0},wt={key:1},zt={__name:"index",props:{columns:Object,order:String,modelName:String,postWidth:{type:String,default:()=>500},formLayout:{type:String,default:()=>"horizontal"},formStyle:String,postHeight:String,postComponent:Object},setup(e){const{columns:a,order:s,modelName:l,postWidth:b,postHeight:v,postComponent:y}=e;a.push({title:"",slotName:"action",align:"right",width:120});const p=re(),w=x(null),F=x([]),R=oe(()=>p.mainHeight-38),j=le({type:"checkbox",showCheckedAll:!0}),L=oe(()=>rt(Y,pe,m,p)),G=x(null),T=nt("data_table_limit",20),de={page:1,limit:T.value,order:s,where:{field:"",operator:"",value:""}},m=le(de),D=x(!1),k=x({}),A=x(null),W=x(null),J=x(null),Q=x(null),{data:X,run:me,loading:fe}=S(Te,ut(l,m)),{data:pe,run:ge,loading:Y}=S(Ae,{defaultParams:[l,m]}),{run:he}=S(We,ct(I)),{run:_e,loading:ve}=S(Je,dt(F,ee)),{run:be,loading:M}=S(Qe,mt(k,W)),{run:ye,loading:ke}=S(Xe,ft(D,ee,J)),{run:we,loading:Ce}=S(Ye,pt(D,X,A,k,Q)),{run:xe}=S(Ze,gt(I));z("record",k),z("selectedKeys",F),z("batchDelete",_e),z("modelName",l),z("postRecordGetSuccessCallback",W),z("createBeforeCallback",J),z("updateSuccessCallback",Q);function Se(){k.value={},D.value=!0}function Z(u,c){D.value=!0,k.value={},A.value=c,be(l,u.id)}function $e(){G.value.validate(u=>{u===void 0&&(k.value.id>0?we(l,k.value):ye(l,k.value))})}function Fe(){D.value=!1}function ee(){I(),te()}function I(){me(l,m)}function te(){ge(l,m.where)}function De(u){m.page=u,I()}function Ie(u){m.page=1,m.limit=u,T.value=u,I()}function ze(u,c){m.page=1,c?m.order=u+" "+c.replace("end",""):m.order=s,I()}function Ne(u,[c,O]){c===void 0?m.where={field:"",operator:"",value:""}:(m.where.field=u,m.where.value=c,m.where.operator=O===!0?"like":"equal"),m.page=1,I(),te()}function Oe(u){let c;return l==="article"?c=p.config.router.article_rule:l==="category"?c=p.config.router.category_rule:l==="tag"&&(c=p.config.router.tag_rule),et(p,c.replace("{slug}",u))}const{run:Ve}=S(tt,{manual:!0});function Le(u){return new Date().getTime()/1e3-u.create_time<u.detect_delay*60}return(u,c)=>{const O=r("a-button"),U=r("a-space"),ne=r("a-spin"),H=r("a-tag"),Re=r("icon-clock-circle"),Be=r("a-switch"),Pe=r("a-table"),je=r("a-divider"),Me=r("a-form"),Ue=r("a-modal");return g(),$(B,null,[n(U,{class:"mb-2",size:"medium"},{default:t(()=>[n(O,{size:"small",type:"primary",onClick:Se},{default:t(()=>[h(f(u.$t("create")),1)]),_:1}),n(lt)]),_:1}),n(Pe,{ref_key:"table",ref:w,"row-key":"id",style:q({height:i(R)+"px"}),columns:e.columns,data:i(X),bordered:!1,loading:i(fe)||i(ve),"filter-icon-align-left":"",scroll:{x:"100%",y:i(R)-78},"row-selection":j,selectedKeys:F.value,"onUpdate:selectedKeys":c[2]||(c[2]=o=>F.value=o),pagination:i(L),"onUpdate:pagination":c[3]||(c[3]=o=>Ee(L)?L.value=o:null),"virtual-list-props":m.limit>100?{height:"100%"}:void 0,onPageChange:De,onPageSizeChange:Ie,onSorterChange:ze,onFilterChange:Ne},{th:t(()=>[ht]),td:t(({record:o,rowIndex:_})=>[V("td",{style:{color:"var(--color-text-1)"},class:"border-opacity-30",onDblclick:d=>Z(o,_)},null,40,_t)]),"pagination-left":t(()=>[V("div",null,[i(Y)?(g(),N(ne,{key:0})):ie("",!0)])]),"column-search":t(({filterValue:o,setFilterValue:_,handleFilterConfirm:d,handleFilterReset:C})=>[n(it,{filterValue:o,setFilterValue:_,handleFilterConfirm:d,handleFilterReset:C},null,8,["filterValue","setFilterValue","handleFilterConfirm","handleFilterReset"])]),action:t(({record:o,rowIndex:_})=>[n(st,{record:o,rowIndex:_,onEdit:Z,runDelete:i(he),modelName:e.modelName},null,8,["record","rowIndex","runDelete","modelName"])]),time:t(({record:o,rowIndex:_,column:d})=>[o[d.dataIndex]>0?(g(),N(i(ae),{key:0,time:o[d.dataIndex],to:Date.now()/1e3,type:"relative",unix:""},null,8,["time","to"])):(g(),$("span",vt," - "))]),expire_time:t(({record:o,rowIndex:_,column:d})=>[o[d.dataIndex]>0?(g(),$(B,{key:0},[o[d.dataIndex]<=Date.now()/1e3?(g(),N(H,{key:0,color:"red"},{default:t(()=>[h(f(u.$t("expired")),1)]),_:1})):(g(),N(H,{key:1,color:"blue"},{default:t(()=>[n(i(ae),{time:o[d.dataIndex],to:Date.now()/1e3,type:"relative",unix:""},null,8,["time","to"])]),_:2},1024))],64)):(g(),$("span",bt," - "))]),title:t(({record:o,rowIndex:_,column:d})=>[V("span",{onClick:C=>i(E)(Oe(o.slug)),style:{"min-width":"50px"},class:"inline-block cursor-pointer hover:underline underline-offset-4 decoration-2 hover:text-blue-500"},f(o[d.dataIndex]),9,yt)]),detect:t(({record:o,rowIndex:_,column:d})=>[o[d.dataIndex]?(g(),$("span",kt,[n(Re,{size:16,strokeWidth:5,style:q({color:Le(o)?"#FBBF24":"#3B82F6"})},null,8,["style"])])):(g(),$("span",wt," - "))]),linkStatus:t(({record:o,rowIndex:_,column:d})=>[n(Be,{type:"line","default-checked":o.status,onChange:C=>i(Ve)(o.id,C),onDblclick:c[0]||(c[0]=Ke(()=>{},["stop"]))},null,8,["default-checked","onChange"])]),url:t(({record:o,rowIndex:_,column:d})=>[V("span",{onClick:c[1]||(c[1]=(...C)=>i(E)&&i(E)(...C)),class:"inline-block cursor-pointer hover:underline underline-offset-4 decoration-2 hover:text-blue-500"},f(o[d.dataIndex]),1)]),storePost:t(({record:o,rowIndex:_,column:d})=>[n(O,{type:"outline",size:"mini",onClick:C=>i(xe)(o.id)},{default:t(()=>[h(f(u.$t("publish")),1)]),_:2},1032,["onClick"])]),tag:t(({record:o,rowIndex:_,column:d})=>[n(U,null,{default:t(()=>[(g(!0),$(B,null,qe(o[d.dataIndex],C=>(g(),N(H,{size:"mini"},{default:t(()=>[h(f(C),1)]),_:2},1024))),256))]),_:2},1024)]),_:1},8,["style","columns","data","loading","scroll","row-selection","selectedKeys","pagination","virtual-list-props"]),n(Ue,{visible:D.value,"onUpdate:visible":c[4]||(c[4]=o=>D.value=o),width:e.postWidth,unmountOnClose:"",titleAlign:"start",escToClose:!1,"mask-closable":!1,"mask-style":{backdropFilter:"blur(2px)"},"body-style":{height:i(p).isMobile?"100%":"calc(100% - 48px)",padding:i(p).isMobile?"5px":"7px 10px"},"modal-class":"data-table-modal",modalStyle:{height:e.postHeight?e.postHeight:void 0},footer:!1},{title:t(()=>[h(f(k.value.id>0?u.$t("edit"):u.$t("create")),1)]),default:t(()=>[n(Me,{ref_key:"formRef",ref:G,layout:e.formLayout,class:"w-full h-full",model:k.value,style:q(e.formStyle)},{default:t(()=>[n(ne,{loading:i(M),class:se(["w-full h-full overflow-auto",{"overflow-hidden":i(M)}]),size:28},{default:t(()=>[(g(),N(Ge(e.postComponent)))]),_:1},8,["loading","class"]),n(je,{margin:i(p).isMobile?5:10},null,8,["margin"]),n(U,{class:"w-full flex justify-end"},{default:t(()=>[n(O,{onClick:Fe},{default:t(()=>[h(f(u.$t("cancel")),1)]),_:1}),n(O,{type:"primary",onClick:$e,disabled:i(M),loading:i(ke)||i(Ce)},{default:t(()=>[h(f(u.$t("confirm")),1)]),_:1},8,["disabled","loading"])]),_:1})]),_:1},8,["layout","model","style"])]),_:1},8,["visible","width","mask-style","body-style","modalStyle"])],64)}}};export{zt as _,It as s};
