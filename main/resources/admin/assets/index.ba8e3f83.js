import{j as c,k as s,l as d,m as e,v as o,$ as r,y as n,z as l,p as I,F as L,Q as X,s as w,n as b,r as C,c as A,Y as Z,V as ee}from"./@vue.0987707a.js";import{a as te}from"./vue-router.0ed66d6f.js";import{f as O,e as V,u as ae,v as le}from"./index.3eae3a9f.js";import{a as ie}from"./@vueuse.d5398ce4.js";import{a as oe}from"./vue-request.6886b8d7.js";import{f as $}from"./naive-ui.506a45a0.js";import"./vue-i18n.e3137642.js";import"./@intlify.bed9fa1a.js";import"./source-map.205bdfab.js";import"./vue.5c5bb0aa.js";import"./@arco-design.55369db5.js";import"./resize-observer-polyfill.8deb1e21.js";import"./compute-scroll-into-view.17358474.js";import"./b-tween.87ffe365.js";import"./dayjs.396bdce9.js";import"./b-validate.ee581f7d.js";import"./number-precision.6dad9ff9.js";import"./scroll-into-view-if-needed.61c672a4.js";import"./pinia.2e07300c.js";import"./vue-demi.b3a9cad9.js";import"./axios.b9f958b0.js";/* empty css                    */import"./date-fns.a06005bd.js";import"./seemly.d0f7d7a4.js";import"./evtd.9eee5233.js";import"./@css-render.6ced7bf3.js";import"./css-render.20ab466e.js";import"./@emotion.6322e2ae.js";import"./vooks.3f61458b.js";import"./vueuc.5f5811a3.js";import"./vdirs.ab69c576.js";import"./@juggle.32c34d6c.js";import"./lodash-es.33d1f95f.js";import"./date-fns-tz.c3c7eb03.js";const ne=[{width:30,slotName:"detail"},{title:"time",dataIndex:"time",slotName:"time",width:120},{title:"level",dataIndex:"level",slotName:"level",width:100},{title:"file",dataIndex:"file",ellipsis:!0,width:200},{title:"message",dataIndex:"msg",ellipsis:!0,width:200},{title:"more",dataIndex:"more",slotName:"more",ellipsis:!0,width:300}],D=[{width:30,slotName:"detail"},{title:"time",dataIndex:"time",slotName:"time",width:120},{title:"take",dataIndex:"take",slotName:"take",width:100},{title:"file",dataIndex:"file",ellipsis:!0,width:170},{title:"rows",dataIndex:"rows",slotName:"rows",width:80},{title:"sql",dataIndex:"sql",ellipsis:!0,width:400}],R=[{width:30,slotName:"detail"},{title:"time",dataIndex:"time",slotName:"time",width:120},{title:"take",dataIndex:"take",slotName:"take",width:100},{title:"status",dataIndex:"status",slotName:"status",width:80},{title:"depth",dataIndex:"depth",width:70},{title:"ip",dataIndex:"ip",width:140,ellipsis:!0,tooltip:!0},{title:"region",dataIndex:"region",width:220,ellipsis:!0,tooltip:!0},{title:"method",dataIndex:"method",width:80},{title:"url",dataIndex:"url",width:300,ellipsis:!0,tooltip:!0,slotName:"url"},{title:"referer",dataIndex:"referer",width:300,ellipsis:!0,tooltip:!0,slotName:"url"},{title:"userAgent",dataIndex:"userAgent",width:1e3,ellipsis:!0,tooltip:!0}];function se(){let i=O(R);return i.splice(2,0,{title:"feature",dataIndex:"feature",width:130,ellipsis:!0,tooltip:!0}),i}const re={class:"font-mono text-gray-500 whitespace-pre"},de={__name:"app",props:{data:Object},setup(i){return(x,v)=>{const a=c("a-descriptions-item"),p=c("a-descriptions");return s(),d(p,{column:1,bordered:""},{default:e(()=>[o(a,{label:"time"},{default:e(()=>[o(r($),{time:i.data.time},null,8,["time"])]),_:1}),o(a,{label:"level"},{default:e(()=>[n(l(i.data.level),1)]),_:1}),o(a,{label:"file"},{default:e(()=>[n(l(i.data.file),1)]),_:1}),o(a,{label:"msg"},{default:e(()=>[n(l(i.data.msg),1)]),_:1}),(s(!0),I(L,null,X(i.data.more,(u,f)=>(s(),I(L,null,[f!=="buf"?(s(),d(a,{key:0,label:f},{default:e(()=>[n(l(u),1)]),_:2},1032,["label"])):w("",!0)],64))),256)),i.data.buf?(s(),d(a,{key:0,label:"buf"},{default:e(()=>[b("code",re,l(i.data.buf),1)]),_:1})):w("",!0)]),_:1})}}},ue={class:"whitespace-normal"},me={class:"font-mono text-gray-500 whitespace-pre-line"},ce={__name:"http",props:{data:Object},setup(i){return(x,v)=>{const a=c("a-descriptions-item"),p=c("a-descriptions");return s(),d(p,{column:1,bordered:""},{default:e(()=>[o(a,{label:"time"},{default:e(()=>[o(r($),{time:i.data.time},null,8,["time"])]),_:1}),o(a,{label:"take"},{default:e(()=>[n(l(i.data.take)+" ms",1)]),_:1}),o(a,{label:"status"},{default:e(()=>[n(l(i.data.status),1)]),_:1}),o(a,{label:"depth"},{default:e(()=>[n(l(i.data.depth),1)]),_:1}),o(a,{label:"method"},{default:e(()=>[n(l(i.data.method),1)]),_:1}),o(a,{label:"ip"},{default:e(()=>[n(l(i.data.ip),1)]),_:1}),i.data.feature?(s(),d(a,{key:0,label:"feature"},{default:e(()=>[n(l(i.data.feature),1)]),_:1})):w("",!0),o(a,{label:"url"},{default:e(()=>[b("a",{class:"hover:underline cursor-pointer hover:text-blue-400",onClick:v[0]||(v[0]=u=>r(V)(i.data.url))},l(i.data.url),1)]),_:1}),o(a,{label:"referer"},{default:e(()=>[b("a",{class:"hover:underline cursor-pointer hover:text-blue-400",onClick:v[1]||(v[1]=u=>r(V)(i.data.referer))},l(i.data.referer),1)]),_:1}),o(a,{label:"user-agent"},{default:e(()=>[b("span",ue,l(i.data.userAgent),1)]),_:1}),o(a,{label:"headers"},{default:e(()=>[b("code",me,l(i.data.headers),1)]),_:1})]),_:1})}}};const pe={class:"py-2 my-2"},fe=["innerHTML"],_e={__name:"sql",props:{data:Object},setup(i){let x=["select ","from ","distinct"," where "," order by "," group by "," insert into"," inner join"," left join"," and ","having","values","on conflict","do update set"," create table"," limit "," as "," update "," offset "," set ","do nothing","alter table ","alter column ","type ","default ","in "];function v(a){if(!a)return a;for(let p=0;p<x.length;p++){let u=x[p],f=u.toUpperCase();a=a.replaceAll(u,f),a=a.replaceAll(f,"<b>"+f+"</b>")}return a.replace(/"([^"]*)"/g,'"<i>$1</i>"').replace(/'([^']*)'/g,"'<i>$1</i>'")}return(a,p)=>{const u=c("a-descriptions-item"),f=c("a-descriptions");return s(),d(f,{column:1,bordered:""},{default:e(()=>[o(u,{label:"time"},{default:e(()=>[o(r($),{time:i.data.time},null,8,["time"])]),_:1}),o(u,{label:"level"},{default:e(()=>[n(l(i.data.level),1)]),_:1}),o(u,{label:"take"},{default:e(()=>[n(l(i.data.take)+" ms",1)]),_:1}),o(u,{label:"file"},{default:e(()=>[n(l(i.data.file),1)]),_:1}),o(u,{label:"rows"},{default:e(()=>[n(l(i.data.rows),1)]),_:1}),o(u,{label:"msg"},{default:e(()=>[n(l(i.data.msg),1)]),_:1}),o(u,{label:"sql"},{default:e(()=>[b("div",pe,[b("code",{class:"sql font-mono whitespace-pre-line",innerHTML:v(i.data.sql)},null,8,fe)])]),_:1})]),_:1})}}},he=b("th",{style:{color:"var(--color-text-1)","background-color":"var(--color-fill-2)"}},null,-1),be=b("td",{style:{color:"var(--color-text-1)"}},null,-1),ye={class:"flex items-center"},ge=["onClick"],ve={key:0},ke={key:1},we={key:0},lt={__name:"index",setup(i){const x=ae(),a=te().params.id.toString(),p=ie("log_limit",100),u=C(),f=A(()=>x.mainHeight-66),z=C(!1),N=C({}),T=A(()=>{switch(a){case"app":return ne;case"sql":return D;case"slow_sql":return D;case"visitor":return R;case"spider":return se()}});async function H(m){const y=m!=null&&m.page?m.page+1:1,g=await le(a,{page:y,limit:p.value});return{list:P(g),page:y}}const{loading:M,loadingMore:B,dataList:j,loadMore:F,refresh:K}=oe(H,{});function q(){K()}function P(m){if(m=m.reverse(),a!=="app")return m;for(let y in m){let g=O(m[y]);delete g.level,delete g.time,delete g.file,delete g.msg,m[y].more=g}return m}return(m,y)=>{const g=c("a-input-number"),S=c("a-button"),U=c("a-space"),Q=c("icon-eye"),W=c("a-link"),_=c("a-tag"),E=c("a-table"),J=c("a-card"),Y=c("a-modal");return s(),I(L,null,[o(J,{class:"w-full",size:"small",title:m.$t(r(a)),bordered:!1,"body-style":{padding:"0"},"header-style":{border:"none",padding:"8px 0"}},{extra:e(()=>[o(U,null,{default:e(()=>[o(g,{size:"small",modelValue:r(p),"onUpdate:modelValue":y[0]||(y[0]=t=>Z(p)?p.value=t:null),style:{width:"80px"},min:1,onKeyup:ee(q,["enter"])},null,8,["modelValue","onKeyup"]),o(S,{size:"small",onClick:q,type:"outline"},{default:e(()=>[n(l(m.$t("refresh")),1)]),_:1}),o(S,{size:"small",onClick:r(F),type:"outline"},{default:e(()=>[n(l(m.$t("more")),1)]),_:1},8,["onClick"])]),_:1})]),default:e(()=>[o(E,{size:"mini",ref_key:"tableRef",ref:u,columns:r(T),data:r(j),pagination:!1,scroll:{y:r(f)},"virtual-list-props":r(j).length>1?{height:r(f),buffer:30}:void 0,loading:r(M)||r(B),style:{"--border-radius-medium":"0"}},{th:e(()=>[he]),td:e(()=>[be]),detail:e(({record:t,rowIndex:k,column:h})=>[b("div",ye,[o(W,{onClick:G=>{z.value=!0,N.value=t}},{default:e(()=>[o(Q,{style:{color:"#6b7f94"}})]),_:2},1032,["onClick"])])]),time:e(({record:t,rowIndex:k,column:h})=>[o(r($),{time:t.time,to:Date.now(),type:"relative"},null,8,["time","to"])]),take:e(({record:t,rowIndex:k,column:h})=>[t.take<100?(s(),d(_,{key:0,size:"mini",color:"blue"},{default:e(()=>[n(l(t.take.toFixed(2))+" ms",1)]),_:2},1024)):t.take<200?(s(),d(_,{key:1,size:"mini",color:"orange"},{default:e(()=>[n(l(parseInt(t.take))+" ms",1)]),_:2},1024)):t.take<500?(s(),d(_,{key:2,size:"mini",color:"purple"},{default:e(()=>[n(l(parseInt(t.take))+" ms",1)]),_:2},1024)):(s(),d(_,{key:3,size:"mini",color:"red"},{default:e(()=>[n(l(parseInt(t.take))+" ms",1)]),_:2},1024))]),status:e(({record:t,rowIndex:k,column:h})=>[t.status>=500?(s(),d(_,{key:0,size:"mini",color:"red"},{default:e(()=>[n(l(t.status),1)]),_:2},1024)):t.status>=400?(s(),d(_,{key:1,size:"mini",color:"orange"},{default:e(()=>[n(l(t.status),1)]),_:2},1024)):t.status>=300?(s(),d(_,{key:2,size:"mini",color:"blue"},{default:e(()=>[n(l(t.status),1)]),_:2},1024)):(s(),d(_,{key:3,size:"mini",color:"green"},{default:e(()=>[n(l(t.status),1)]),_:2},1024))]),url:e(({record:t,rowIndex:k,column:h})=>[b("a",{class:"hover:underline cursor-pointer hover:text-blue-400",onClick:G=>r(V)(t[h.dataIndex])},l(t[h.dataIndex]),9,ge)]),level:e(({record:t,rowIndex:k,column:h})=>[t.level==="info"?(s(),d(_,{key:0,size:"mini",color:"blue"},{default:e(()=>[n(l(t.level),1)]),_:2},1024)):t.level==="debug"?(s(),d(_,{key:1,size:"mini",color:"cyan"},{default:e(()=>[n(l(t.level),1)]),_:2},1024)):(s(),d(_,{key:2,size:"mini",color:"red"},{default:e(()=>[n(l(t.level),1)]),_:2},1024))]),rows:e(({record:t,rowIndex:k,column:h})=>[t.rows>-1?(s(),I("span",ve,l(t.rows),1)):(s(),I("span",ke," - "))]),more:e(({record:t,rowIndex:k,column:h})=>[Object.keys(t[h.dataIndex]).length>0?(s(),I("div",we,l(JSON.stringify(t[h.dataIndex]).substring(0,130)),1)):w("",!0)]),_:1},8,["columns","data","scroll","virtual-list-props","loading"])]),_:1},8,["title"]),o(Y,{visible:z.value,"onUpdate:visible":y[1]||(y[1]=t=>z.value=t),title:"Log detail","title-align":"start","modal-style":{width:"auto",height:"92%",minWidth:"600px",maxWidth:"80%"},"body-style":{height:"calc(100% - 52px)"},footer:!1},{default:e(()=>[r(a)==="app"?(s(),d(de,{key:0,data:N.value},null,8,["data"])):w("",!0),r(a)==="sql"||r(a)==="slow_sql"?(s(),d(_e,{key:1,data:N.value},null,8,["data"])):w("",!0),r(a)==="visitor"||r(a)==="spider"?(s(),d(ce,{key:2,data:N.value},null,8,["data"])):w("",!0)]),_:1},8,["visible","body-style"])],64)}}};export{lt as default};
