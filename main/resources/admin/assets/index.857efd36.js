import{j as c,k as d,l as m,m as e,v as l,$ as s,y as n,z as i,p as k,F as L,Q as G,s as I,n as h,r as z,c as D,Y as X,V as Z,u as ee}from"./@vue.1832462a.js";import{a as te}from"./vue-router.d0ac2f3e.js";import{e as V,u as ae,v as le,f as ie}from"./index.ad236f72.js";import{a as oe}from"./@vueuse.b7caaad8.js";import{a as ne}from"./vue-request.068b6d0d.js";import{f as $}from"./naive-ui.4ada00fb.js";import"./vue-i18n.32b246c6.js";import"./@intlify.bed9fa1a.js";import"./source-map.205bdfab.js";import"./vue.307b73bb.js";import"./@arco-design.fc217e7a.js";import"./resize-observer-polyfill.8deb1e21.js";import"./compute-scroll-into-view.17358474.js";import"./b-tween.87ffe365.js";import"./dayjs.396bdce9.js";import"./b-validate.ee581f7d.js";import"./number-precision.6dad9ff9.js";import"./scroll-into-view-if-needed.61c672a4.js";import"./pinia.3d582541.js";import"./vue-demi.b3a9cad9.js";import"./axios.7d4390ff.js";import"./form-data.2b153385.js";/* empty css                    */import"./date-fns.a06005bd.js";import"./seemly.d0f7d7a4.js";import"./evtd.9eee5233.js";import"./@css-render.fee374bc.js";import"./css-render.20ab466e.js";import"./@emotion.6322e2ae.js";import"./vooks.186fd3b0.js";import"./vueuc.533174bc.js";import"./vdirs.ab69c576.js";import"./@juggle.32c34d6c.js";import"./lodash-es.33d1f95f.js";import"./date-fns-tz.c3c7eb03.js";const se=[{width:30,slotName:"detail"},{title:"time",dataIndex:"time",slotName:"time",width:120},{title:"level",dataIndex:"level",slotName:"level",width:100},{title:"file",dataIndex:"file",ellipsis:!0,width:200},{title:"message",dataIndex:"msg",ellipsis:!0,width:200},{title:"more",dataIndex:"more",slotName:"more",ellipsis:!0,width:300}],O=[{width:30,slotName:"detail"},{title:"time",dataIndex:"time",slotName:"time",width:120},{title:"take",dataIndex:"take",slotName:"take",width:100},{title:"file",dataIndex:"file",ellipsis:!0,width:170},{title:"rows",dataIndex:"rows",slotName:"rows",width:80},{title:"sql",dataIndex:"sql",ellipsis:!0,width:400}],R=[{width:30,slotName:"detail"},{title:"time",dataIndex:"time",slotName:"time",width:120},{title:"take",dataIndex:"take",slotName:"take",width:100},{title:"status",dataIndex:"status",slotName:"status",width:80},{title:"depth",dataIndex:"depth",width:70},{title:"ip",dataIndex:"ip",width:110,ellipsis:!0},{title:"region",dataIndex:"region",width:130,ellipsis:!0},{title:"method",dataIndex:"method",width:80},{title:"url",dataIndex:"url",width:400,ellipsis:!0,slotName:"url"},{title:"referer",dataIndex:"referer",width:300,ellipsis:!0,slotName:"url"},{title:"userAgent",dataIndex:"userAgent",width:600,ellipsis:!0}],de={class:"font-mono text-gray-500 whitespace-pre"},re={__name:"app",props:{data:Object},setup(o){return(w,v)=>{const t=c("a-descriptions-item"),p=c("a-descriptions");return d(),m(p,{column:1,bordered:""},{default:e(()=>[l(t,{label:"time"},{default:e(()=>[l(s($),{time:o.data.time},null,8,["time"])]),_:1}),l(t,{label:"level"},{default:e(()=>[n(i(o.data.level),1)]),_:1}),l(t,{label:"file"},{default:e(()=>[n(i(o.data.file),1)]),_:1}),l(t,{label:"msg"},{default:e(()=>[n(i(o.data.msg),1)]),_:1}),(d(!0),k(L,null,G(o.data.more,(r,f)=>(d(),k(L,null,[f!=="buf"?(d(),m(t,{key:0,label:f},{default:e(()=>[n(i(r),1)]),_:2},1032,["label"])):I("",!0)],64))),256)),o.data.buf?(d(),m(t,{key:0,label:"buf"},{default:e(()=>[h("code",de,i(o.data.buf),1)]),_:1})):I("",!0)]),_:1})}}},ue={class:"font-mono text-gray-500 whitespace-pre"},me={__name:"http",props:{data:Object},setup(o){return(w,v)=>{const t=c("a-descriptions-item"),p=c("a-descriptions");return d(),m(p,{column:1,bordered:""},{default:e(()=>[l(t,{label:"time"},{default:e(()=>[l(s($),{time:o.data.time},null,8,["time"])]),_:1}),l(t,{label:"take"},{default:e(()=>[n(i(o.data.take)+" ms",1)]),_:1}),l(t,{label:"status"},{default:e(()=>[n(i(o.data.status),1)]),_:1}),l(t,{label:"depth"},{default:e(()=>[n(i(o.data.depth),1)]),_:1}),l(t,{label:"method"},{default:e(()=>[n(i(o.data.method),1)]),_:1}),l(t,{label:"ip"},{default:e(()=>[n(i(o.data.ip),1)]),_:1}),l(t,{label:"region"},{default:e(()=>[n(i(o.data.region),1)]),_:1}),l(t,{label:"url"},{default:e(()=>[h("a",{class:"hover:underline cursor-pointer hover:text-blue-400",onClick:v[0]||(v[0]=r=>s(V)(o.data.url))},i(o.data.url),1)]),_:1}),l(t,{label:"referer"},{default:e(()=>[h("a",{class:"hover:underline cursor-pointer hover:text-blue-400",onClick:v[1]||(v[1]=r=>s(V)(o.data.referer))},i(o.data.referer),1)]),_:1}),l(t,{label:"user-agent"},{default:e(()=>[n(i(o.data.userAgent),1)]),_:1}),l(t,{label:"headers"},{default:e(()=>[h("code",ue,i(o.data.headers),1)]),_:1})]),_:1})}}};const ce={class:"py-2 my-2"},pe=["innerHTML"],fe={__name:"sql",props:{data:Object},setup(o){let w=["select ","from ","distinct"," where "," order by "," group by "," insert into"," inner join"," left join"," and ","having","values","on conflict","do update set"," create table"," limit "," as "," update "," offset "," set ","do nothing","alter table ","alter column ","type ","default ","in "];function v(t){if(!t)return t;for(let p=0;p<w.length;p++){let r=w[p],f=r.toUpperCase();t=t.replaceAll(r,f),t=t.replaceAll(f,"<b>"+f+"</b>")}return t.replace(/"([^"]*)"/g,'"<i>$1</i>"').replace(/'([^']*)'/g,"'<i>$1</i>'")}return(t,p)=>{const r=c("a-descriptions-item"),f=c("a-descriptions");return d(),m(f,{column:1,bordered:""},{default:e(()=>[l(r,{label:"time"},{default:e(()=>[l(s($),{time:o.data.time},null,8,["time"])]),_:1}),l(r,{label:"level"},{default:e(()=>[n(i(o.data.level),1)]),_:1}),l(r,{label:"take"},{default:e(()=>[n(i(o.data.take)+" ms",1)]),_:1}),l(r,{label:"file"},{default:e(()=>[n(i(o.data.file),1)]),_:1}),l(r,{label:"rows"},{default:e(()=>[n(i(o.data.rows),1)]),_:1}),l(r,{label:"msg"},{default:e(()=>[n(i(o.data.msg),1)]),_:1}),l(r,{label:"sql"},{default:e(()=>[h("div",ce,[h("code",{class:"sql font-mono",innerHTML:v(o.data.sql)},null,8,pe)])]),_:1})]),_:1})}}},_e=h("th",{style:{color:"var(--color-text-1)","background-color":"var(--color-fill-2)"}},null,-1),he=h("td",{style:{color:"var(--color-text-1)"}},null,-1),be={class:"flex items-center"},ge=["onClick"],ve={key:0},ye={key:1},xe={key:0},lt={__name:"index",setup(o){const w=ae(),t=te().params.id.toString(),p=oe("log_limit",100),r=z(),f=D(()=>w.mainHeight-66),C=z(!1),N=z({}),S=D(()=>{switch(t){case"app":return se;case"sql":return O;case"slow_sql":return O;case"visitor":return R;case"spider":return R}});async function T(u){const b=u!=null&&u.page?u.page+1:1,g=await le(t,{page:b,limit:p.value});return{list:K(g),page:b}}const{loading:H,loadingMore:M,dataList:j,loadMore:B,refresh:F}=ne(T,{});function q(){F()}function K(u){if(u=u.reverse(),t!=="app")return u;for(let b in u){let g=ie(u[b]);delete g.level,delete g.time,delete g.file,delete g.msg,u[b].more=g}return u}return(u,b)=>{const g=c("a-input-number"),A=c("a-button"),P=c("a-space"),U=c("icon-eye"),Q=c("a-link"),y=c("a-tag"),W=c("a-table"),E=c("a-card"),J=c("a-modal");return d(),k(L,null,[l(E,{class:"w-full",size:"small",title:u.$t(s(t)),bordered:!1,"body-style":{padding:"0"},"header-style":{border:"none",padding:"8px 0"}},{extra:e(()=>[l(P,null,{default:e(()=>[l(g,{size:"small",modelValue:s(p),"onUpdate:modelValue":b[0]||(b[0]=a=>X(p)?p.value=a:null),style:{width:"80px"},min:1,onKeyup:Z(q,["enter"])},null,8,["modelValue","onKeyup"]),l(A,{size:"small",onClick:q,type:"outline"},{default:e(()=>[n(i(u.$t("refresh")),1)]),_:1}),l(A,{size:"small",onClick:s(B),type:"outline"},{default:e(()=>[n(i(u.$t("more")),1)]),_:1},8,["onClick"])]),_:1})]),default:e(()=>[l(W,{size:"mini",ref_key:"tableRef",ref:r,columns:s(S),data:s(j),pagination:!1,scroll:{y:s(f)},"virtual-list-props":s(j).length>1?{height:s(f),buffer:30}:void 0,loading:s(H)||s(M),style:{"--border-radius-medium":"0"}},{th:e(()=>[_e]),td:e(()=>[he]),detail:e(({record:a,rowIndex:x,column:_})=>[h("div",be,[l(Q,{onClick:Y=>{C.value=!0,N.value=a}},{default:e(()=>[l(U,{style:{color:"#6b7f94"}})]),_:2},1032,["onClick"])])]),time:e(({record:a,rowIndex:x,column:_})=>[l(s($),{time:a.time,to:Date.now(),type:"relative"},null,8,["time","to"])]),take:e(({record:a,rowIndex:x,column:_})=>[a.take<100?(d(),m(y,{key:0,size:"mini",color:"blue"},{default:e(()=>[n(i(a.take.toFixed(2))+" ms",1)]),_:2},1024)):a.take<200?(d(),m(y,{key:1,size:"mini",color:"orange"},{default:e(()=>[n(i(parseInt(a.take))+" ms",1)]),_:2},1024)):a.take<500?(d(),m(y,{key:2,size:"mini",color:"purple"},{default:e(()=>[n(i(parseInt(a.take))+" ms",1)]),_:2},1024)):(d(),m(y,{key:3,size:"mini",color:"red"},{default:e(()=>[n(i(parseInt(a.take))+" ms",1)]),_:2},1024))]),status:e(({record:a,rowIndex:x,column:_})=>[h("span",{class:ee({"text-yellow-500":a.status>=400&&a.status<500,"text-red-500":a.status>=500})},i(a.status),3)]),url:e(({record:a,rowIndex:x,column:_})=>[h("a",{class:"hover:underline cursor-pointer hover:text-blue-400",onClick:Y=>s(V)(a[_.dataIndex])},i(a[_.dataIndex]),9,ge)]),level:e(({record:a,rowIndex:x,column:_})=>[a.level==="info"?(d(),m(y,{key:0,size:"mini",color:"blue"},{default:e(()=>[n(i(a.level),1)]),_:2},1024)):a.level==="debug"?(d(),m(y,{key:1,size:"mini",color:"cyan"},{default:e(()=>[n(i(a.level),1)]),_:2},1024)):(d(),m(y,{key:2,size:"mini",color:"red"},{default:e(()=>[n(i(a.level),1)]),_:2},1024))]),rows:e(({record:a,rowIndex:x,column:_})=>[a.rows>-1?(d(),k("span",ve,i(a.rows),1)):(d(),k("span",ye," - "))]),more:e(({record:a,rowIndex:x,column:_})=>[Object.keys(a[_.dataIndex]).length>0?(d(),k("div",xe,i(JSON.stringify(a[_.dataIndex]).substring(0,130)),1)):I("",!0)]),_:1},8,["columns","data","scroll","virtual-list-props","loading"])]),_:1},8,["title"]),l(J,{visible:C.value,"onUpdate:visible":b[1]||(b[1]=a=>C.value=a),title:"Log detail","title-align":"start","modal-style":{width:"auto",height:"92%",minWidth:"600px",maxWidth:"80%"},"body-style":{height:"calc(100% - 52px)"},footer:!1},{default:e(()=>[s(t)==="app"?(d(),m(re,{key:0,data:N.value},null,8,["data"])):I("",!0),s(t)==="sql"||s(t)==="slow_sql"?(d(),m(fe,{key:1,data:N.value},null,8,["data"])):I("",!0),s(t)==="visitor"||s(t)==="spider"?(d(),m(me,{key:2,data:N.value},null,8,["data"])):I("",!0)]),_:1},8,["visible","body-style"])],64)}}};export{lt as default};
