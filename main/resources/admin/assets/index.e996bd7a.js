import{i as A,r as C,j as i,k as f,p as $,$ as l,F as U,v as n,m as e,l as z,y as v,z as p,s as E,n as P,u as ue,X as He,c as se,a as ie,B as N,q as X,H as Ke,Q as qe,Y as Ae,O as Ee}from"./@vue.0987707a.js";import{u as w}from"./vue-request.6886b8d7.js";import{n as Ge,o as Te,k as R,u as ce,e as Y,i as We,p as Je,q as Qe,r as Xe,s as Ye,v as Ze,w as et,x as tt,j as nt,y as ot}from"./index.ef0cbf4c.js";import{a as lt}from"./@vueuse.d5398ce4.js";import{S as at}from"./SelectCategory.0a1e8e4c.js";import{M as Z,v as st}from"./@arco-design.38d3ffc1.js";import{o as re}from"./naive-ui.0057ea16.js";const it={__name:"Checkbox",setup(t){const s=A("selectedKeys"),r=A("batchDelete"),o=A("modelName"),F=A("refresh"),k=C(!1),h=C();function g(){o==="article"&&O(h.value,s.value),o==="category"&&M(h.value,s.value)}let S={manual:!0,onSuccess:x=>{!x.success||(s.value=[],F(),Z.success(R("message.success",[R("update")])))}};const{run:O}=w(Ge,S),{run:M}=w(Te,S);return(x,y)=>{const j=i("icon-down"),H=i("a-button"),G=i("icon-edit"),d=i("a-doption"),D=i("icon-delete"),b=i("a-dropdown"),K=i("a-tag"),q=i("a-modal");return f(),$(U,null,[l(s).length>0?(f(),$(U,{key:0},[n(b,{"popup-max-height":!1,trigger:"hover"},{content:e(()=>[l(o)==="article"||l(o)==="category"?(f(),z(d,{key:0,onClick:y[0]||(y[0]=I=>k.value=!0)},{icon:e(()=>[n(G)]),default:e(()=>[v(" "+p(x.$t("update"))+" "+p(l(o)==="article"?x.$t("category"):x.$t("parentCategory")),1)]),_:1})):E("",!0),n(d,{onClick:y[1]||(y[1]=I=>l(r)(l(o),l(s))),style:{color:"rgb(var(--red-6))"}},{icon:e(()=>[n(D)]),default:e(()=>[v(" "+p(x.$t("delete")),1)]),_:1})]),default:e(()=>[n(H,{size:"small"},{icon:e(()=>[n(j)]),default:e(()=>[v(" "+p(x.$t("action")),1)]),_:1})]),_:1}),n(K,{class:"ml-4 overflow-hidden",style:{"border-radius":"18px","background-color":"var(--color-fill-2)"},onClose:y[2]||(y[2]=I=>s.value=[]),closable:""},{default:e(()=>[v(p(x.$t("checked"))+" "+p(l(s).length),1)]),_:1})],64)):E("",!0),l(o)==="article"||l(o)==="category"?(f(),z(q,{key:1,visible:k.value,"onUpdate:visible":y[4]||(y[4]=I=>k.value=I),onOk:g,simple:""},{default:e(()=>[n(at,{modelValue:h.value,"onUpdate:modelValue":y[3]||(y[3]=I=>h.value=I)},null,8,["modelValue"])]),_:1},8,["visible"])):E("",!0)],64)}}},rt={class:"flex justify-between select-none"},ut={__name:"ColumnSearch",props:{filterValue:Object,setFilterValue:Function,handleFilterReset:Function,handleFilterConfirm:Function},setup(t){const s=ce();return(r,o)=>{const F=i("a-input"),k=i("a-checkbox"),h=i("a-button"),g=i("a-space");return f(),$("div",{class:ue(["p-3 shadow-md",{border:!l(s).dark}]),style:{"background-color":"var(--color-bg-1)"}},[n(g,{direction:"vertical"},{default:e(()=>[n(F,{"model-value":t.filterValue[0],placeholder:r.$t("search"),onInput:o[0]||(o[0]=S=>t.setFilterValue([S,t.filterValue[1]]))},null,8,["model-value","placeholder"]),P("div",rt,[n(k,{modelValue:t.filterValue[1],"onUpdate:modelValue":o[1]||(o[1]=S=>t.filterValue[1]=S)},{default:e(()=>[v("Like")]),_:1},8,["modelValue"]),n(g,{class:"pl-5"},{default:e(()=>[n(h,{size:"mini",onClick:t.handleFilterReset},{default:e(()=>[v(p(r.$t("reset")),1)]),_:1},8,["onClick"]),n(h,{type:"primary",size:"mini",onClick:t.handleFilterConfirm},{default:e(()=>[v(p(r.$t("confirm")),1)]),_:1},8,["onClick"])]),_:1})])]),_:1})],2)}}},ct={__name:"Action",props:{record:Object,modelName:String,rowIndex:Number,runDelete:Function,onEdit:Function},setup(t){return(s,r)=>{const o=i("a-button"),F=i("icon-down"),k=i("icon-delete"),h=i("a-doption"),g=i("a-dropdown"),S=i("a-button-group");return f(),z(S,{size:"mini"},{default:e(()=>[n(o,{onClick:r[0]||(r[0]=O=>t.onEdit(t.record,t.rowIndex))},{default:e(()=>[v(p(s.$t("edit")),1)]),_:1}),n(g,{position:"br",size:"small"},{content:e(()=>[n(h,{onClick:r[1]||(r[1]=O=>t.runDelete(t.modelName,t.record.id)),style:{color:"rgb(var(--red-6))"}},{icon:e(()=>[n(k)]),default:e(()=>[v(" "+p(s.$t("delete")),1)]),_:1})]),default:e(()=>[n(o,null,{icon:e(()=>[n(F)]),_:1})]),_:1})]),_:1})}}},Nt={slotName:"column-search",icon:()=>He(st)};function dt(t,s,r,o){return{total:t.value?9999:s.value,defaultPageSize:r.limit,showTotal:!t.value,showJumper:!o.isMobile&&!t.value,showPageSize:!o.isMobile&&!t.value,simple:o.isMobile||t.value,pageSizeOptions:[10,20,30,40,50,100,500,1e3,2e3,5e3]}}function mt(t,s){return{defaultParams:[t,s]}}function ft(t){return{manual:!0,onSuccess:s=>{s.success&&t()}}}function pt(t,s){return{manual:!0,onSuccess:r=>{!r.success||(t.value=[],s())}}}function gt(t,s){return{manual:!0,onSuccess:r=>{t.value=r,s.value&&s.value(r)}}}function vt(t,s,r){return{manual:!0,onBefore:()=>{r.value&&r.value()},onSuccess:o=>{if(!o.success)return de(o);t.value=!1,s()}}}function yt(t,s,r,o,F){return{manual:!0,onSuccess:k=>{if(!k.success)return de(k);t.value=!1;for(let h in s.value[r.value])s.value[r.value][h]=o.value[h];F.value&&F.value()}}}function ht(t){return{manual:!0,onSuccess:s=>{s.success&&(Z.success(R("message.success",[R("publish")])),t())}}}function de(t){t.message.toLowerCase().indexOf("unique")>-1&&t.message.toLowerCase().indexOf("slug")>-1&&Z.error(R("message.exists",[R("slug")]))}const _t=P("th",{style:{color:"var(--color-text-3)"}},null,-1),bt=["onDblclick"],kt={key:1},Ct={key:1},wt=["onClick"],St={key:0},xt={key:1},Bt={__name:"index",props:{columns:Object,order:String,modelName:String,postWidth:{type:String,default:()=>500},formLayout:{type:String,default:()=>"horizontal"},formStyle:String,postHeight:String,postComponent:Object},setup(t){const{columns:s,order:r,modelName:o,postWidth:F,postHeight:k,postComponent:h}=t;s.push({title:"",slotName:"action",align:"right",width:120});const g=ce(),S=C(null),O=C([]),M=se(()=>g.mainHeight-38),x=ie({type:"checkbox",showCheckedAll:!0}),y=se(()=>dt(ne,pe,d,g)),j=C(null),H=lt("data_table_limit",20),G={page:1,limit:H.value,order:r,where:{field:"",operator:"",value:""}},d=ie(G),D=C(!1),b=C({}),K=C(null),q=C(null),I=C(null),ee=C(null),{data:te,run:me,loading:fe}=w(We,mt(o,d)),{data:pe,run:ge,loading:ne}=w(Je,{defaultParams:[o,d]}),{run:ve}=w(Qe,ft(B)),{run:ye,loading:he}=w(Xe,pt(O,W)),{run:_e,loading:T}=w(Ye,gt(b,q)),{run:be,loading:ke}=w(Ze,vt(D,W,I)),{run:Ce,loading:we}=w(et,yt(D,te,K,b,ee)),{run:Se}=w(tt,ht(B));N("record",b),N("selectedKeys",O),N("batchDelete",ye),N("modelName",o),N("postRecordGetSuccessCallback",q),N("createBeforeCallback",I),N("updateSuccessCallback",ee);function xe(){b.value={},D.value=!0}function oe(u,c){D.value=!0,b.value={},K.value=c,_e(o,u.id)}function $e(){j.value.validate(u=>{u===void 0&&(b.value.id>0?Ce(o,b.value):be(o,b.value))})}function Fe(){D.value=!1}function W(){B(),le()}N("refresh",W);function B(){me(o,d)}function le(){ge(o,d.where)}function De(u){d.page=u,B()}function Ie(u){d.page=1,d.limit=u,H.value=u,B()}function Ve(u,c){d.page=1,c?d.order=u+" "+c.replace("end",""):d.order=r,B()}function ze(u,[c,L]){c===void 0?d.where={field:"",operator:"",value:""}:(d.where.field=u,d.where.value=c,d.where.operator=L===!0?"like":"equal"),d.page=1,B(),le()}function Oe(u){let c;return o==="article"?c=g.config.router.article_rule:o==="category"?c=g.config.router.category_rule:o==="tag"&&(c=g.config.router.tag_rule),nt(g,c.replace("{slug}",u))}const{run:Ne}=w(ot,{manual:!0});function Be(u){return new Date().getTime()/1e3-u.create_time<u.detect_delay*60}return(u,c)=>{const L=i("a-button"),J=i("a-space"),ae=i("a-spin"),Q=i("a-tag"),Le=i("icon-clock-circle"),Pe=i("a-switch"),Re=i("a-table"),Ue=i("a-divider"),Me=i("a-form"),je=i("a-modal");return f(),$(U,null,[n(J,{class:"mb-2",size:"medium"},{default:e(()=>[n(L,{size:"small",type:"primary",onClick:xe},{default:e(()=>[v(p(u.$t("create")),1)]),_:1}),n(it)]),_:1}),n(Re,{ref_key:"table",ref:S,"row-key":"id",style:X({height:l(M)+"px"}),columns:t.columns,data:l(te),bordered:!1,loading:l(fe)||l(he),"filter-icon-align-left":"",scroll:{x:"100%",y:l(M)-78},"row-selection":x,selectedKeys:O.value,"onUpdate:selectedKeys":c[2]||(c[2]=a=>O.value=a),pagination:l(y),"onUpdate:pagination":c[3]||(c[3]=a=>Ae(y)?y.value=a:null),"virtual-list-props":d.limit>100?{height:"100%"}:void 0,onPageChange:De,onPageSizeChange:Ie,onSorterChange:Ve,onFilterChange:ze},{th:e(()=>[_t]),td:e(({record:a,rowIndex:_})=>[P("td",{style:{color:"var(--color-text-1)"},class:"border-opacity-30",onDblclick:m=>oe(a,_)},null,40,bt)]),"pagination-left":e(()=>[P("div",null,[l(ne)?(f(),z(ae,{key:0})):E("",!0)])]),"column-search":e(({filterValue:a,setFilterValue:_,handleFilterConfirm:m,handleFilterReset:V})=>[n(ut,{filterValue:a,setFilterValue:_,handleFilterConfirm:m,handleFilterReset:V},null,8,["filterValue","setFilterValue","handleFilterConfirm","handleFilterReset"])]),action:e(({record:a,rowIndex:_})=>[n(ct,{record:a,rowIndex:_,onEdit:oe,runDelete:l(ve),modelName:t.modelName},null,8,["record","rowIndex","runDelete","modelName"])]),time:e(({record:a,rowIndex:_,column:m})=>[a[m.dataIndex]>0?(f(),z(l(re),{key:0,time:a[m.dataIndex],to:Date.now()/1e3,type:"relative",unix:""},null,8,["time","to"])):(f(),$("span",kt," - "))]),expire_time:e(({record:a,rowIndex:_,column:m})=>[a[m.dataIndex]>0?(f(),$(U,{key:0},[a[m.dataIndex]<=Date.now()/1e3?(f(),z(Q,{key:0,color:"red"},{default:e(()=>[v(p(u.$t("expired")),1)]),_:1})):(f(),z(Q,{key:1,color:"blue"},{default:e(()=>[n(l(re),{time:a[m.dataIndex],to:Date.now()/1e3,type:"relative",unix:""},null,8,["time","to"])]),_:2},1024))],64)):(f(),$("span",Ct," - "))]),title:e(({record:a,rowIndex:_,column:m})=>[P("span",{onClick:V=>l(Y)(Oe(a.slug)),style:{"min-width":"50px"},class:"inline-block cursor-pointer hover:underline underline-offset-4 decoration-2 hover:text-blue-500"},p(a[m.dataIndex]),9,wt)]),detect:e(({record:a,rowIndex:_,column:m})=>[a[m.dataIndex]?(f(),$("span",St,[n(Le,{size:16,strokeWidth:5,style:X({color:Be(a)?"#FBBF24":"#3B82F6"})},null,8,["style"])])):(f(),$("span",xt," - "))]),linkStatus:e(({record:a,rowIndex:_,column:m})=>[n(Pe,{type:"line","default-checked":a.status,onChange:V=>l(Ne)(a.id,V),onDblclick:c[0]||(c[0]=Ke(()=>{},["stop"]))},null,8,["default-checked","onChange"])]),url:e(({record:a,rowIndex:_,column:m})=>[P("span",{onClick:c[1]||(c[1]=(...V)=>l(Y)&&l(Y)(...V)),class:"inline-block cursor-pointer hover:underline underline-offset-4 decoration-2 hover:text-blue-500"},p(a[m.dataIndex]),1)]),storePost:e(({record:a,rowIndex:_,column:m})=>[n(L,{type:"outline",size:"mini",onClick:V=>l(Se)(a.id)},{default:e(()=>[v(p(u.$t("publish")),1)]),_:2},1032,["onClick"])]),tag:e(({record:a,rowIndex:_,column:m})=>[n(J,null,{default:e(()=>[(f(!0),$(U,null,qe(a[m.dataIndex],V=>(f(),z(Q,{size:"mini"},{default:e(()=>[v(p(V),1)]),_:2},1024))),256))]),_:2},1024)]),_:1},8,["style","columns","data","loading","scroll","row-selection","selectedKeys","pagination","virtual-list-props"]),n(je,{visible:D.value,"onUpdate:visible":c[4]||(c[4]=a=>D.value=a),width:t.postWidth,unmountOnClose:"",titleAlign:"start",escToClose:!1,"mask-closable":!1,"mask-style":{backdropFilter:"blur(2px)"},"body-style":{height:l(g).isMobile?"100%":"calc(100% - 48px)",padding:l(g).isMobile?"5px":"7px 10px"},"modal-class":"data-table-modal",modalStyle:{height:t.postHeight?t.postHeight:void 0},footer:!1},{title:e(()=>[v(p(b.value.id>0?u.$t("edit"):u.$t("create")),1)]),default:e(()=>[n(Me,{ref_key:"formRef",ref:j,layout:t.formLayout,"auto-label-width":"",class:"w-full h-full",model:b.value,style:X(t.formStyle)},{default:e(()=>[n(ae,{loading:l(T),class:ue(["w-full h-full overflow-auto",{"overflow-hidden":l(T)}]),size:28},{default:e(()=>[(f(),z(Ee(t.postComponent)))]),_:1},8,["loading","class"]),n(Ue,{margin:l(g).isMobile?5:10},null,8,["margin"]),n(J,{class:"w-full flex justify-end"},{default:e(()=>[n(L,{onClick:Fe},{default:e(()=>[v(p(u.$t("cancel")),1)]),_:1}),n(L,{type:"primary",onClick:$e,disabled:l(T),loading:l(ke)||l(we)},{default:e(()=>[v(p(u.$t("confirm")),1)]),_:1},8,["disabled","loading"])]),_:1})]),_:1},8,["layout","model","style"])]),_:1},8,["visible","width","mask-style","body-style","modalStyle"])],64)}}};export{Bt as _,Nt as s};
